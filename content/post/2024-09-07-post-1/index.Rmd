---
title: Blog Post 1
author: Rachael Dziaba
date: '2024-09-07'
slug: post-1
categories:
  - blog
tags: []
draft: false
---

In my first blog post of the series, I will be analyzing and visualizing two foundational questions about the election: 
   1. How competitive are presidential elections in the United States? 
   2. Which states vote blue/red and how consistently?

I also will be customizing my visualizations (extension 1). See citations for data and other sources at the bottom. Code can be found in my Github repository.

------------------------------------------------------------------------


```{r plot1, echo=FALSE, warning=FALSE, message=FALSE}
# The following is based on code provided by Matthew Dardet in our first laboratory session. Datasets (unless otherwise noted) provided in class.

# Load libraries.
library(ggplot2)
library(maps)
library(tidyverse)
library(knitr)

# Set working directory
setwd("/Users/racha1/Desktop/election-blog/content/post/2024-09-07-post-1")

# Read presidential popular vote.
d_popvote <- read_csv("popvote_1948-2020.csv")

# Pivot data to wide format with party names as columns and two-party vote share as values.
(d_popvote_wide <- d_popvote %>%
    select(year, party, pv2p) %>%
    pivot_wider(names_from = party, values_from = pv2p))

# Modify winner column to show "D" if Democrats win and "R" if Republicans win.
(d_popvote_wide <- d_popvote_wide %>% 
    mutate(winner = case_when(democrat > republican ~ "D",
                              TRUE ~ "R")))

# Summarize data to show winners.
summary_table <- d_popvote_wide %>%
  group_by(winner) %>%
  summarise(races = n())

# Present in table
print(summary_table)

# Set custom theme for plots
my_custom_theme <- theme_bw() + 
  theme(panel.border = element_blank(),
        plot.title = element_text(family = "Georgia", size = 15, face = "bold", hjust = 0.5),
        axis.text = element_text(family = "Georgia", size = 12),
        axis.line = element_line(colour = "black"),
        legend.position = "bottom",
        legend.title = element_text(family = "Georgia", size = 12),
        legend.text = element_text(family = "Georgia", size = 12),
        legend.box.background = element_rect(color = "black", size = 0.5), 
        axis.title.x = element_text(family = "Georgia", size = 13),
        axis.title.y = element_text(family = "Georgia", size = 13))

# Create and customize line plot to visualize 
d_popvote %>%
  ggplot(aes(x = year, y = pv2p, color = party)) + 
  geom_line() +
  geom_point(size = 2) +
  scale_color_manual(values = c("royalblue3", "red3"), labels = c("Democrat", "Republican")) +
  ggtitle("Two-Party Presidential Vote Share") +
  labs(x = "Year", y = "Popular Vote Percentage", color = "Party:") +
  my_custom_theme

```

```{r plot2, echo=FALSE}

# The following is a combination of code provided by Matthew Dardet and code used in Ethan Jasny's "Blog Post 1" from 2022 (https://ethanjasny.github.io/gov1347/post/2022-09-09-test-post-1/)

# Load libraries
library(usmap)
library(plotly)

# State abbreviation data downloaded from Jason Ong's github (https://github.com/jasonong/List-of-US-States/blob/master/states.csv?plain=1)

# Read state abbreviations
state.abbrevs <- read_csv("states.csv")

# Modify winner column to be "1" if Republicans win and "-1" if Democrats win.
winners_map <- d_pvstate_wide %>% 
  mutate(winner = ifelse(R_pv > D_pv, 1, -1)) %>%
# Join with state abbreviation dataset
  left_join(state.abbrevs, by = c("state" = "State"))

# Define map layout (source: Ethan Jasny)
map_layout <- list(
  scope = 'usa',
  projection = list(type = 'albers usa'),
  showlakes = FALSE,
  lakecolor = toRGB('white'))

# Create map of winners in each state over time
# Code for type, colorscale, text, and hoverinfo developed with assistance from ChatGPT 

winners_map %>% plot_geo(locationmode = "USA-states") %>% 
  add_trace(type = 'choropleth', z = ~winner, locations = ~Abbreviation,
            colorscale = list(c(0, 'royalblue3'), c(0.5, 'white'), c(1, 'red3')),
            zmin = -1,
            zmax = 1,
            frame = ~year, 
            showscale = FALSE,
            text = ~paste(Abbreviation),
            hoverinfo = 'text') %>%
              layout(title = "Two-Party Presidential Winner by State", font = list(family = "Georgia"),
                     geo = map_layout)
```

```{r plot3, echo=FALSE}

# The following is adapted from the above, combining code provided by Matthew Dardet and code used in Ethan Jasny's "Blog Post 1" from 2022 (https://ethanjasny.github.io/gov1347/post/2022-09-09-test-post-1/)
 
# Load libraries
library(usmap)
library(plotly)

# Read state abbreviation data (source: Jason Ong)
state.abbrevs <- read_csv("states.csv")

# Modify winner column to say Republican if Republicans won and Democrats if Democrats won. Modify margin to be the difference in the two-party popular votes. Join with state abbreviation data
margin_map <- d_pvstate_wide %>% 
  mutate(winner = ifelse(R_pv > D_pv, "Republican", "Democrat"), margin = R_pv2p - D_pv2p) %>%
  left_join(state.abbrevs, by = c("state" = "State"))

# Set map layout.
map_layout <- list(
  scope = 'usa',
  projection = list(type = 'albers usa'),
  showlakes = FALSE,
  lakecolor = toRGB('white'))

# Create map of margins in each state.
# Code for text and colorbar developed with assistance of ChatGPT
margin_map %>% plot_geo(locationmode = "USA-states") %>% 
  add_trace(type = 'choropleth', z = ~margin, locations = ~Abbreviation,
            colorscale = list(c(0, 'royalblue3'), c(0.5, 'white'), c(1, 'red3')),
            zmin = -100,
            zmax = 100,
            frame = ~year, 
            showscale = TRUE,
            text = ~paste(Abbreviation, "<br>",
                          "Democratic:", round(D_pv2p, 1),"%<br>",
                          "Republican:", round(R_pv2p, 1),"%<br>"),
            hoverinfo = 'text',
            colorbar = list(title = "Win Margin <br> (Rep-Dem)", 
                            tickvals = c(-100, -50, -25, 0, 25, 50, 100),
                            ticktext = c("-100", "-50", "-25", "0", "25", "50", "100"))) %>%
              layout(title = "Two-Party Presidential Vote Share by State", font = list(family = "Georgia"),
                     geo = map_layout)
```

```{r prediction, echo = FALSE}

# The following is based on code provided by Matthew Dardet.

# Sequester shapefile of states from `maps` library.
states_map <- map_data("state")

# Create prediction (pv2p and margin) based on simplified electoral cycle model:
# vote_2024 = 3/4*vote_2020 + 1/4*vote_2016 (lag1, lag2, respectively). 
pv2p_2024_states <- d_pvstate_wide %>%
  filter(year == 2020) %>%
  group_by(state) %>% 
  summarize(D_pv2p_2024 = 0.75*D_pv2p + 0.25*D_pv2p_lag1, 
            R_pv2p_2024 = 0.75*R_pv2p + 0.25*R_pv2p_lag1) %>% 
  mutate(pv2p_2024_margin = R_pv2p_2024 - D_pv2p_2024,
         region = tolower(state))

# Plot the margin of victory in a U.S. state map.
pv2p_2024_states %>%
  left_join(states_map, by = "region") %>%
  ggplot(aes(long, lat, group = group)) + 
  geom_polygon(aes(fill = pv2p_2024_margin), color = "black") + 
  scale_fill_gradient2(high = "red3", 
                       low = "royalblue3", 
                       mid = "white", 
                       name = "Vote Margin (Rep-Dem)", 
                       breaks = c(-50, -25, 0, 25, 50), 
                       limits = c(-50, 50)) + 
  ggtitle("Projected Two-Party Presidential Vote Share in 2024") +
  theme_void() +
  theme(text = element_text(family = "Georgia"))

# Read electoral college votes. 
ec <- read_csv("ec_full (1).csv")

# Modify winner column again and join with electoral college votes
pv2p_2024_states <- pv2p_2024_states %>%
  mutate(year = 2024, 
         winner = ifelse(R_pv2p_2024 > D_pv2p_2024, "R", "D")) %>% 
  left_join(ec, by = c("state", "year"))

# Generate summary of electoral college winner by combining projected state winners.
winner_2024 <- pv2p_2024_states %>%
  group_by(winner) %>%
  summarize(electoral_votes = sum(electors))

# Show electoral college summaries
print(winner_2024)
```
